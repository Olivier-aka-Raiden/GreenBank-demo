<!DOCTYPE html>
<html lang="fr" class="no-js">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge"> 
		<meta name="viewport" content="width=device-width, initial-scale=1"> 
		<title>Green Bank - Simulation</title>
		<meta name="description" content="Formulaire Green Bank de simulation d'emprunt pour l'achat d'une voiture" />
		<meta name="keywords" content="Green Bank, Fomulaire, simulation, Asynconf, web design" />
		<meta name="author" content="Olivier V." />
		<link rel="shortcut icon" href="favicon.ico">
		<link rel="stylesheet" type="text/css" href="css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="css/demo.css" />
		<link rel="stylesheet" type="text/css" href="css/component.css" />
		<link rel="stylesheet" type="text/css" href="css/cs-select.css" />
		<link rel="stylesheet" type="text/css" href="css/cs-skin-boxes.css" />
		<script src="js/modernizr.custom.js"></script>
	</head>
	<body>
		<div class="container">

			<div class="fs-form-wrap" id="fs-form-wrap">
				<div class="fs-title">
					<h1>Green Bank</h1>
					<div class="codrops-top">
						<a class="codrops-icon codrops-icon-info" href="#"><span>Simulateur d'emprunt pour l'achat d'une voiture Green Bank</span></a>
					</div>

					<div id="welcome-message" class="hidden top-title">
						<label class="label"></label>
					</div>
				</div>
				<form id="myform" name="myForm" class="fs-form fs-form-full" autocomplete="off" action="http://localhost:3000" method="POST">
					<ol class="fs-fields">
						<li>
							<label class="fs-field-label fs-anim-upper" for="q1">Quel est votre nom ?</label>
							<input class="fs-anim-lower" id="q1" name="nom" type="text" placeholder="John Doe" required/>
						</li>
						<li data-input-trigger>
							<label class="fs-field-label fs-anim-upper" data-info="What type of vehicule are you looking for ?">Type de voiture recherchée : </label>
							<div class="fs-radio-group fs-radio-custom clearfix fs-anim-lower" required>
								<span><input id="q2b" name="voiture" type="radio" value="Citadine"/><label for="q2b" class="radio-citadine">Citadine</label></span>
								<span><input id="q2c" name="voiture" type="radio" value="Cabriolet"/><label for="q2c" class="radio-cabriolet">Cabriolet</label></span>
								<span><input id="q2a" name="voiture" type="radio" value="Berline"/><label for="q2a" class="radio-berline">Berline</label></span>
								<span><input id="q2d" name="voiture" type="radio" value="SUV"/><label for="q2d" class="radio-suv">SUV</label></span>
							</div>
						</li>
						<li data-input-trigger>
							<label class="fs-field-label fs-anim-upper" for="q3" data-info="Engine type choice">Choix de la motorisation : </label>
							<div required>
								<select id="q3" name="energie" class="cs-select engine-select cs-skin-boxes fs-anim-lower" required>
									<option value="" disabled selected>Choisir une motorisation</option>
									<option value="essence" data-class="color-588c75 essence">Essence</option>
									<option value="diesel" data-class="color-588c75 diesel">Diesel</option>
									<option value="electrique" data-class="color-588c75 electrique">Électrique</option>
									<option value="hybride" data-class="color-588c75 hybride">Hybride</option>
								</select>
							</div>
						</li>
						<li data-input-trigger>
							<label class="fs-field-label fs-anim-upper" for="q4" data-info="Distance par year (km)">Kilométrage / an : </label>
							<div required>
								<select id="q4" name="kilometrage" class="cs-select dist-select cs-skin-boxes fs-anim-lower" required>
									<option value="" disabled selected>Sélectionner un kilométrage</option>
									<option value="cinq" data-class="color-588c75 cinq">5000 km - 10 000 km</option>
									<option value="dix" data-class="color-588c75 dix">10 000 km - 15 000 km</option>
									<option value="quinze" data-class="color-588c75 quinze">15 000 km - 20 000 km</option>
									<option value="vingt" data-class="color-588c75 vingt">20 000 km - 25 000 km</option>
									<option value="vingtcinq" data-class="color-588c75 vingtcinq">25 000 km - 30 000 km</option>
								</select>
							</div>
						</li>
						<li data-input-trigger>
							<label class="fs-field-label fs-anim-upper" data-info="How old will your car be?">Année de la première immatriculation : </label>
							<div class="fs-radio-group fs-radio-custom clearfix fs-anim-lower" required>
								<span><input id="q5b" name="annee" type="radio" value="1960"/><label for="q5b" class="radio-sixzero">1960 - 1970</label></span>
								<span><input id="q5c" name="annee" type="radio" value="1970"/><label for="q5c" class="radio-septzero">1970 - 1990</label></span>
								<span><input id="q5a" name="annee" type="radio" value="1990"/><label for="q5a" class="radio-neufzero">1990 - 2000</label></span>
								<span><input id="q5d" name="annee" type="radio" value="2000"/><label for="q5d" class="radio-deuxzero">2000 - 2010</label></span>
								<span><input id="q5e" name="annee" type="radio" value="2010"/><label for="q5e" class="radio-deuxdix">Après 2010</label></span>
							</div>
						</li>
						<li>
							<label class="fs-field-label fs-anim-upper" for="q6">Nombre de passager : </label>
							<input class="fs-person fs-anim-lower" id="q6" name="passager" type="number" placeholder="1" step="1" min="1" max="4" required/>
						</li>
					</ol><!-- /fs-fields -->

					<div id="result-container" class="hidden">
						<label class="label" for="result">Résultat de votre simulation :</label>
						<div id="result"></div>
						<!-- The result will be displayed here -->
					</div>
					<button class="fs-submit" type="submit">Calculer votre taux d'emprunt</button>
				</form><!-- /fs-form -->
			</div><!-- /fs-form-wrap -->
		</div><!-- /container -->
		<script src="js/classie.js"></script>
		<script src="js/selectFx.js"></script>
		<script src="js/fullscreenForm.js"></script>
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				// Get references to the input field and the welcome message div
				const resultContainer = document.getElementById('result-container');
				const result = document.getElementById('result');
				const form = document.getElementById('myform');
				form.addEventListener('submit', async (event) => {
					event.preventDefault();
					const formData = new FormData(event.target);
					const nom = formData.get('nom');
					const voiture = formData.get('voiture');
					const energie = formData.get('energie');
					const kilometrage = formData.get('kilometrage');
					const annee = formData.get('annee');
					const passager = formData.get('passager');
					const body = {nom : nom, voiture: voiture, energie: energie, kilometrage: kilometrage, annee: annee, passager: passager};
					console.log(body);
					try {
						const response = await fetch('http://localhost:3000', {
							method: 'POST',
							body: JSON.stringify(body), // Convert the object to a JSON string
							headers: {
								'Content-Type': 'application/json' // Set the content type to JSON
							}
						});

						if (response.ok) {
							const data = await response.json();
							const resultat = data.resultat;
							resultContainer.classList.remove('hidden')
							// Update the result container with the received result
							result.textContent = `${resultat}%`;
						} else {
							console.error('Server returned an error');
						}
					} catch (error) {
						console.error('An error occurred:', error);
					}
				});
			});
			(function() {
				var formWrap = document.getElementById( 'fs-form-wrap' );
				[].slice.call( document.querySelectorAll( 'select.dist-select.cs-select' ) ).forEach( function(el) {
					new SelectFx( el, {
						stickyPlaceholder: false,
						onChange: function(val){
							document.querySelector('span.cs-placeholder.dist-select').classList.add(val);
						}
					});
				} );
				[].slice.call( document.querySelectorAll( 'select.engine-select.cs-select' ) ).forEach( function(el) {
					new SelectFx( el, {
						stickyPlaceholder: false,
						onChange: function(val){
							document.querySelector('span.cs-placeholder').classList.add(val);
						}
					});
				} );

				new FForm( formWrap, {
					onReview : function() {
						classie.add( document.body, 'overview' ); // for demo purposes only
					}
				} );
			})();
		</script>
	</body>
</html>